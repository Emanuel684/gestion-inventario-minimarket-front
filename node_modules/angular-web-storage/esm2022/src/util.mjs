/**
 * 判断是否在浏览器中渲染Angular应用
 * `decorator` 无法直接使用Angular `PLATFORM_ID` 标识
 * 这带来的好处是当服务端自行填充 Document 时也能很好的识别
 */
export const isBrowser = typeof document === 'object' && !!document;
export class StorageUtil {
    static get(storage, key) {
        if (storage == null) {
            return null;
        }
        const value = StorageUtil.parse(storage.getItem(key) || 'null') || null;
        if (value === null) {
            return null;
        }
        if (typeof value === 'object' && typeof value._expired !== 'undefined' && value._expired !== 0 && +new Date() > value._expired) {
            StorageUtil.remove(storage, key);
            return null;
        }
        return value._value || null;
    }
    static set(storage, key, value, expiredAt = 0, expiredUnit = 't') {
        if (storage == null) {
            return;
        }
        storage.setItem(key, StorageUtil.stringify({
            _expired: StorageUtil.getExpired(expiredAt, expiredUnit),
            _value: value,
        }));
    }
    static remove(storage, key) {
        if (storage == null) {
            return;
        }
        storage.removeItem(key);
    }
    static key(storage, index) {
        if (storage == null) {
            return null;
        }
        return storage.key(index);
    }
    static getExpired(val, unit) {
        if (val <= 0) {
            return 0;
        }
        const now = +new Date();
        switch (unit) {
            case 's': // 秒
                return now + 1000 * val;
            case 'm': // 分
                return now + 1000 * 60 * val;
            case 'h': // 时
                return now + 1000 * 60 * 60 * val;
            case 'd': // 天
                return now + 1000 * 60 * 60 * 24 * val;
            case 'w': // 周
                return now + 1000 * 60 * 60 * 24 * 7 * val;
            case 'y': // 年
                return now + 1000 * 60 * 60 * 24 * 365 * val;
            case 't': // 自定义
                return now + val;
            default:
                return 0;
        }
    }
    static stringify(value) {
        return JSON.stringify(value);
    }
    static parse(text) {
        try {
            return JSON.parse(text) || null;
        }
        catch (e) {
            return text;
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYi9zcmMvdXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFZQTs7OztHQUlHO0FBQ0gsTUFBTSxDQUFDLE1BQU0sU0FBUyxHQUFHLE9BQU8sUUFBUSxLQUFLLFFBQVEsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDO0FBRXBFLE1BQU0sT0FBTyxXQUFXO0lBQ3RCLE1BQU0sQ0FBQyxHQUFHLENBQUMsT0FBdUIsRUFBRSxHQUFXO1FBQzdDLElBQUksT0FBTyxJQUFJLElBQUksRUFBRSxDQUFDO1lBQ3BCLE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQztRQUNELE1BQU0sS0FBSyxHQUFHLFdBQVcsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxNQUFNLENBQUMsSUFBSSxJQUFJLENBQUM7UUFDeEUsSUFBSSxLQUFLLEtBQUssSUFBSSxFQUFFLENBQUM7WUFDbkIsT0FBTyxJQUFJLENBQUM7UUFDZCxDQUFDO1FBQ0QsSUFBSSxPQUFPLEtBQUssS0FBSyxRQUFRLElBQUksT0FBTyxLQUFLLENBQUMsUUFBUSxLQUFLLFdBQVcsSUFBSSxLQUFLLENBQUMsUUFBUSxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksSUFBSSxFQUFFLEdBQUcsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQy9ILFdBQVcsQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQ2pDLE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQztRQUVELE9BQU8sS0FBSyxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUM7SUFDOUIsQ0FBQztJQUVELE1BQU0sQ0FBQyxHQUFHLENBQUMsT0FBdUIsRUFBRSxHQUFXLEVBQUUsS0FBVSxFQUFFLFlBQW9CLENBQUMsRUFBRSxjQUEyQixHQUFHO1FBQ2hILElBQUksT0FBTyxJQUFJLElBQUksRUFBRSxDQUFDO1lBQ3BCLE9BQU87UUFDVCxDQUFDO1FBQ0QsT0FBTyxDQUFDLE9BQU8sQ0FDYixHQUFHLEVBQ0gsV0FBVyxDQUFDLFNBQVMsQ0FBQztZQUNwQixRQUFRLEVBQUUsV0FBVyxDQUFDLFVBQVUsQ0FBQyxTQUFTLEVBQUUsV0FBVyxDQUFDO1lBQ3hELE1BQU0sRUFBRSxLQUFLO1NBQ2QsQ0FBQyxDQUNILENBQUM7SUFDSixDQUFDO0lBRUQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUF1QixFQUFFLEdBQVc7UUFDaEQsSUFBSSxPQUFPLElBQUksSUFBSSxFQUFFLENBQUM7WUFDcEIsT0FBTztRQUNULENBQUM7UUFDRCxPQUFPLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQzFCLENBQUM7SUFFRCxNQUFNLENBQUMsR0FBRyxDQUFDLE9BQXVCLEVBQUUsS0FBYTtRQUMvQyxJQUFJLE9BQU8sSUFBSSxJQUFJLEVBQUUsQ0FBQztZQUNwQixPQUFPLElBQUksQ0FBQztRQUNkLENBQUM7UUFDRCxPQUFPLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDNUIsQ0FBQztJQUVPLE1BQU0sQ0FBQyxVQUFVLENBQUMsR0FBVyxFQUFFLElBQWlCO1FBQ3RELElBQUksR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDO1lBQ2IsT0FBTyxDQUFDLENBQUM7UUFDWCxDQUFDO1FBQ0QsTUFBTSxHQUFHLEdBQUcsQ0FBQyxJQUFJLElBQUksRUFBRSxDQUFDO1FBQ3hCLFFBQVEsSUFBSSxFQUFFLENBQUM7WUFDYixLQUFLLEdBQUcsRUFBRSxJQUFJO2dCQUNaLE9BQU8sR0FBRyxHQUFHLElBQUksR0FBRyxHQUFHLENBQUM7WUFDMUIsS0FBSyxHQUFHLEVBQUUsSUFBSTtnQkFDWixPQUFPLEdBQUcsR0FBRyxJQUFJLEdBQUcsRUFBRSxHQUFHLEdBQUcsQ0FBQztZQUMvQixLQUFLLEdBQUcsRUFBRSxJQUFJO2dCQUNaLE9BQU8sR0FBRyxHQUFHLElBQUksR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEdBQUcsQ0FBQztZQUNwQyxLQUFLLEdBQUcsRUFBRSxJQUFJO2dCQUNaLE9BQU8sR0FBRyxHQUFHLElBQUksR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxHQUFHLENBQUM7WUFDekMsS0FBSyxHQUFHLEVBQUUsSUFBSTtnQkFDWixPQUFPLEdBQUcsR0FBRyxJQUFJLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQztZQUM3QyxLQUFLLEdBQUcsRUFBRSxJQUFJO2dCQUNaLE9BQU8sR0FBRyxHQUFHLElBQUksR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxHQUFHLEdBQUcsR0FBRyxDQUFDO1lBQy9DLEtBQUssR0FBRyxFQUFFLE1BQU07Z0JBQ2QsT0FBTyxHQUFHLEdBQUcsR0FBRyxDQUFDO1lBQ25CO2dCQUNFLE9BQU8sQ0FBQyxDQUFDO1FBQ2IsQ0FBQztJQUNILENBQUM7SUFFTyxNQUFNLENBQUMsU0FBUyxDQUFDLEtBQVU7UUFDakMsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQy9CLENBQUM7SUFFTyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQVk7UUFDL0IsSUFBSSxDQUFDO1lBQ0gsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQztRQUNsQyxDQUFDO1FBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQztZQUNYLE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQztJQUNILENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRXhwaXJhdGlvbiB0aW1lIHVuaXRcbiAqIHM6IHNlY29uZHNcbiAqIG06IG1pbnV0ZVxuICogaDogaG91clxuICogZDogZGF5XG4gKiB3OiB3ZWVrXG4gKiB5OiB5ZWFyXG4gKiB0OiBDdXN0b20gKG1pbGxpc2Vjb25kKVxuICovXG5leHBvcnQgdHlwZSBFeHBpcmVkVW5pdCA9ICdzJyB8ICdtJyB8ICdoJyB8ICdkJyB8ICd3JyB8ICd5JyB8ICd0JztcblxuLyoqXG4gKiDliKTmlq3mmK/lkKblnKjmtY/op4jlmajkuK3muLLmn5NBbmd1bGFy5bqU55SoXG4gKiBgZGVjb3JhdG9yYCDml6Dms5Xnm7TmjqXkvb/nlKhBbmd1bGFyIGBQTEFURk9STV9JRGAg5qCH6K+GXG4gKiDov5nluKbmnaXnmoTlpb3lpITmmK/lvZPmnI3liqHnq6/oh6rooYzloavlhYUgRG9jdW1lbnQg5pe25Lmf6IO95b6I5aW955qE6K+G5YirXG4gKi9cbmV4cG9ydCBjb25zdCBpc0Jyb3dzZXIgPSB0eXBlb2YgZG9jdW1lbnQgPT09ICdvYmplY3QnICYmICEhZG9jdW1lbnQ7XG5cbmV4cG9ydCBjbGFzcyBTdG9yYWdlVXRpbCB7XG4gIHN0YXRpYyBnZXQoc3RvcmFnZTogU3RvcmFnZSB8IG51bGwsIGtleTogc3RyaW5nKTogYW55IHtcbiAgICBpZiAoc3RvcmFnZSA9PSBudWxsKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgdmFsdWUgPSBTdG9yYWdlVXRpbC5wYXJzZShzdG9yYWdlLmdldEl0ZW0oa2V5KSB8fCAnbnVsbCcpIHx8IG51bGw7XG4gICAgaWYgKHZhbHVlID09PSBudWxsKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIHZhbHVlLl9leHBpcmVkICE9PSAndW5kZWZpbmVkJyAmJiB2YWx1ZS5fZXhwaXJlZCAhPT0gMCAmJiArbmV3IERhdGUoKSA+IHZhbHVlLl9leHBpcmVkKSB7XG4gICAgICBTdG9yYWdlVXRpbC5yZW1vdmUoc3RvcmFnZSwga2V5KTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHJldHVybiB2YWx1ZS5fdmFsdWUgfHwgbnVsbDtcbiAgfVxuXG4gIHN0YXRpYyBzZXQoc3RvcmFnZTogU3RvcmFnZSB8IG51bGwsIGtleTogc3RyaW5nLCB2YWx1ZTogYW55LCBleHBpcmVkQXQ6IG51bWJlciA9IDAsIGV4cGlyZWRVbml0OiBFeHBpcmVkVW5pdCA9ICd0Jyk6IHZvaWQge1xuICAgIGlmIChzdG9yYWdlID09IG51bGwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgc3RvcmFnZS5zZXRJdGVtKFxuICAgICAga2V5LFxuICAgICAgU3RvcmFnZVV0aWwuc3RyaW5naWZ5KHtcbiAgICAgICAgX2V4cGlyZWQ6IFN0b3JhZ2VVdGlsLmdldEV4cGlyZWQoZXhwaXJlZEF0LCBleHBpcmVkVW5pdCksXG4gICAgICAgIF92YWx1ZTogdmFsdWUsXG4gICAgICB9KSxcbiAgICApO1xuICB9XG5cbiAgc3RhdGljIHJlbW92ZShzdG9yYWdlOiBTdG9yYWdlIHwgbnVsbCwga2V5OiBzdHJpbmcpOiB2b2lkIHtcbiAgICBpZiAoc3RvcmFnZSA9PSBudWxsKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHN0b3JhZ2UucmVtb3ZlSXRlbShrZXkpO1xuICB9XG5cbiAgc3RhdGljIGtleShzdG9yYWdlOiBTdG9yYWdlIHwgbnVsbCwgaW5kZXg6IG51bWJlcik6IHN0cmluZyB8IG51bGwge1xuICAgIGlmIChzdG9yYWdlID09IG51bGwpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gc3RvcmFnZS5rZXkoaW5kZXgpO1xuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgZ2V0RXhwaXJlZCh2YWw6IG51bWJlciwgdW5pdDogRXhwaXJlZFVuaXQpOiBudW1iZXIge1xuICAgIGlmICh2YWwgPD0gMCkge1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICAgIGNvbnN0IG5vdyA9ICtuZXcgRGF0ZSgpO1xuICAgIHN3aXRjaCAodW5pdCkge1xuICAgICAgY2FzZSAncyc6IC8vIOenklxuICAgICAgICByZXR1cm4gbm93ICsgMTAwMCAqIHZhbDtcbiAgICAgIGNhc2UgJ20nOiAvLyDliIZcbiAgICAgICAgcmV0dXJuIG5vdyArIDEwMDAgKiA2MCAqIHZhbDtcbiAgICAgIGNhc2UgJ2gnOiAvLyDml7ZcbiAgICAgICAgcmV0dXJuIG5vdyArIDEwMDAgKiA2MCAqIDYwICogdmFsO1xuICAgICAgY2FzZSAnZCc6IC8vIOWkqVxuICAgICAgICByZXR1cm4gbm93ICsgMTAwMCAqIDYwICogNjAgKiAyNCAqIHZhbDtcbiAgICAgIGNhc2UgJ3cnOiAvLyDlkahcbiAgICAgICAgcmV0dXJuIG5vdyArIDEwMDAgKiA2MCAqIDYwICogMjQgKiA3ICogdmFsO1xuICAgICAgY2FzZSAneSc6IC8vIOW5tFxuICAgICAgICByZXR1cm4gbm93ICsgMTAwMCAqIDYwICogNjAgKiAyNCAqIDM2NSAqIHZhbDtcbiAgICAgIGNhc2UgJ3QnOiAvLyDoh6rlrprkuYlcbiAgICAgICAgcmV0dXJuIG5vdyArIHZhbDtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc3RhdGljIHN0cmluZ2lmeSh2YWx1ZTogYW55KTogc3RyaW5nIHtcbiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodmFsdWUpO1xuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgcGFyc2UodGV4dDogc3RyaW5nKTogYW55IHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIEpTT04ucGFyc2UodGV4dCkgfHwgbnVsbDtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4gdGV4dDtcbiAgICB9XG4gIH1cbn1cbiJdfQ==